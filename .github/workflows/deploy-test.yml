# =============================================================================
# Wall & Shadow - Deploy to Test Environment
# =============================================================================
#
# This workflow automatically deploys Wall & Shadow to the TEST Firebase
# environment when code is pushed to the main branch.
#
# This is a CALLER WORKFLOW that invokes the shared deployment logic in
# deploy-firebase.yml. See that file for:
#   - Complete setup instructions
#   - How to configure secrets
#   - Security best practices
#   - Troubleshooting tips
#
# =============================================================================
# QUICK SETUP CHECKLIST
# =============================================================================
#
# Before first deployment, complete these steps (details in deploy-firebase.yml):
#
# 1. Create GitHub Environment named "test"
#    Settings → Environments → New environment → "test"
#
# 2. Generate Firebase service account key
#    Firebase Console → Project Settings → Service Accounts → Generate New Private Key
#
# 3. Add "Firebase Admin" role to the service account
#    Google Cloud Console → IAM → Edit service account → Add role
#
# 4. Add FIREBASE_SERVICE_ACCOUNT secret (base64-encoded JSON)
#    GitHub → Settings → Environments → test → Add secret
#
# 5. Add FIREBASE_PROJECT_ID secret
#    GitHub → Settings → Environments → test → Add secret
#
# 6. Grant Pub/Sub Publisher role to Cloud Storage service agent (one-time)
#    Required for storage-triggered functions like onUpload
#
# =============================================================================
# TRIGGERING DEPLOYMENTS
# =============================================================================
#
# This workflow runs automatically when:
#   - Code is pushed to the main branch
#   - You manually trigger it (Actions tab → Deploy to Test → Run workflow)
#
# =============================================================================

name: Deploy to Test

on:
  push:
    branches: [main]
  workflow_dispatch: # Allow manual triggering from GitHub UI

permissions:
  contents: read

jobs:
  deploy:
    name: Deploy to Test Environment
    uses: ./.github/workflows/deploy-firebase.yml
    with:
      environment: test
    secrets: inherit
