# =============================================================================
# Wall & Shadow - Deploy to Production Environment
# =============================================================================
#
# This workflow deploys Wall & Shadow to the PRODUCTION Firebase environment.
#
# ⚠️  IMPORTANT: This workflow ONLY runs when manually triggered.
# ⚠️  It does NOT auto-deploy on push (unlike the test environment).
#
# This is a CALLER WORKFLOW that invokes the shared deployment logic in
# deploy-firebase.yml. See that file for:
#   - Complete setup instructions
#   - How to configure secrets
#   - Security best practices
#   - Troubleshooting tips
#
# =============================================================================
# QUICK SETUP CHECKLIST
# =============================================================================
#
# Before first deployment, complete these steps (details in deploy-firebase.yml):
#
# 1. Create GitHub Environment named "production"
#    Settings → Environments → New environment → "production"
#    RECOMMENDED: Configure protection rules (limit to main branch, add reviewers)
#
# 2. Generate Firebase service account key (SEPARATE from test!)
#    Firebase Console → Project Settings → Service Accounts → Generate New Private Key
#
# 3. Add "Firebase Admin" role to the service account
#    Google Cloud Console → IAM → Edit service account → Add role
#
# 4. Add FIREBASE_SERVICE_ACCOUNT secret (base64-encoded JSON)
#    GitHub → Settings → Environments → production → Add secret
#
# 5. Add FIREBASE_PROJECT_ID secret
#    GitHub → Settings → Environments → production → Add secret
#
# 6. Grant Pub/Sub Publisher role to Cloud Storage service agent (one-time)
#    Required for storage-triggered functions like onUpload
#
# =============================================================================
# PRODUCTION-SPECIFIC NOTES
# =============================================================================
#
# ⚠️  Use a DIFFERENT service account than your test environment!
# ⚠️  Never share credentials between test and production.
#
# RECOMMENDED WORKFLOW:
#   1. Push changes to main (auto-deploys to test environment)
#   2. Test thoroughly in test environment
#   3. Create a git tag for the release (e.g., `git tag v1.5.0 && git push --tags`)
#   4. Manually trigger this workflow to deploy to production
#   5. Monitor for errors and verify functionality
#   6. If issues occur, deploy the previous tagged version
#
# =============================================================================
# TRIGGERING DEPLOYMENTS
# =============================================================================
#
# This workflow ONLY runs when manually triggered:
#   1. Go to your repository on GitHub
#   2. Click "Actions" tab
#   3. Select "Deploy to Production" workflow
#   4. Click "Run workflow" dropdown
#   5. Select branch (usually "main")
#   6. ⚠️  DOUBLE-CHECK you're deploying the correct branch!
#   7. Click "Run workflow"
#
# =============================================================================

name: Deploy to Production

on:
  workflow_dispatch: # ONLY manual triggering - no auto-deploy

permissions:
  contents: read

jobs:
  deploy:
    name: Deploy to Production Environment
    uses: ./.github/workflows/deploy-firebase.yml
    with:
      environment: production
    secrets: inherit
